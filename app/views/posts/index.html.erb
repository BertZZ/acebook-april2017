<% @posts.order(created_at: :desc).each do |post| %>

  <div id="post">
    <div id="post-body">
      <% if post.image_url %>
        <%= image_tag post.image_url.to_s, height: Post::IMAGE_HEIGHT %>
      <% end %>
      <%= post_presenter(post) %>

    </div>
    <div id="post-footer">
      <div id="col-left">
        By: <%= post.user.name %> at <%= time_and_date(post) %>
      </div>
      <div id="col-right">
        <% if current_user %>
          <%= form_tag("/likes", method: "post") do %>
            <%= hidden_field_tag(:user_id, current_user.id) %>
            <%= hidden_field_tag(:post_id, post.id) %>

            <!-- This provides the logic for disabling the button if already liked -->
            <% already_liked = post.likes.any? { |like| like.user_id == current_user.id } %>
            <!-- Builds the button and disables it if already liked -->
            <%= submit_tag "Like (#{post.likes.count})", :class => 'like-button', :disabled => already_liked %>

          <% end %>
        <% end %>
      </div>
    </div>
    <div>
      <h3>Comments</h3>
      <% post.comments.each do |comment| %>
        <p> <%= comment.user.name %> said: <%= comment.body %></p>
      <% end %>
    </div>
    <div>
      Add a comment:
      <%= form_for([post, post.comments.build]) do |comment| %>
        <%= comment.hidden_field(:user_id, value: current_user.id) %>
        <p> <%= comment.text_area :body %></p>
        <p> <%= comment.submit %> </p>
      <% end %>
    </div>
  </div>

  <% end %>

  <%= link_to new_post_path, id: "new-posts" do %>
    New post
  <% end %>
